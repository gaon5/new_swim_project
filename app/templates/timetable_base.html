{% extends "guest/layout.html" %}

{% block mycss %}
    <style>
        #navigation-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #info {
            margin: 0 20px;
        }
        .little_box:hover{
            background-color: #dbe3e8;
        }
    </style>
    {% block timetable_css %}{% endblock %}
{% endblock %}

{% block body %}
    {% block timetable_body1 %}{% endblock %}
    <div class="container mt-3">
        <label for="pool_type"></label>
        <select name="pool_type" id="pool_type">
            <option value="" disabled selected>-- select a pool --</option>
            {% for pool in pool_list %}
                <option value="{{ pool[0] }}">{{ pool[1] }}</option>
            {% endfor %}
        </select>
        <label for="class_type"></label>
        <select name="class_type" id="class_type">
            <option value="" disabled selected>-- select a class type --</option>
            <option value="0">Public Lesson</option>
            <option value="1">Individual Lesson</option>
        </select>
        <label for="instructor"></label>
        <select name="instructor" id="instructor">
            <option value="" disabled selected>-- select a instructor --</option>
            <option value="1">person1</option>
        </select>
    </div>
    <div class="container mt-3">
        <div class="row" style="min-width: 960px">
            <form action="{{ url_for('display_timetable') }}" method="post" id="this_week">
                <input type="hidden" id="day" name="day">
                <div id="navigation-container">
                    <button type="button" class="mx-5 px-2" onclick="previous_week()">&larr;</button>
                    <p id="info" class="px-5">2023</p>
                    <button type="button" class="mx-5 px-2" onclick="next_week()">&rarr;</button>
                </div>
            </form>
            {% for i in range(8) %}
                <div class="col" id="day{{ i }}" style="padding: 0;">
                    <div class="col border text-center" style="background-color: #212529; color: white; height: 50px;">{{ week_list[i][0] }}<br>{{ week_list[i][1] }}</div>
                    {% for j in range(10,19,1) %}
                        {% if i == 0 %}
                            <div class="border text-center" style="height: 100px;">{{ j }}:00</div>
                        {% else %}
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
    {% block timetable_body2 %}{% endblock %}

    <div class="modal fade" id="myOwnModal" tabindex="-1" aria-labelledby="myOwnModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="myOwnModalLabel">Add class</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="pt-3 pb-3">
                        <div class="container w-75">
                            <p>Add class</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="myOwnModal2" tabindex="-1" aria-labelledby="myOwnModalLabel2" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="myOwnModalLabel2">Class Detail</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="pt-3 pb-3">
                        <div class="container w-75">
                            <p>Class Detail</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block myjs %}
    <script>
        const currentDate = new Date("{{ today }}");
        document.getElementById('info').innerHTML = currentDate.toDateString();
        function previous_week(){
            currentDate.setDate(currentDate.getDate() - 7);
            document.getElementById('day').value = currentDate.toISOString().slice(0, 10)
            document.getElementById("this_week").submit();
        }
        function next_week(){
            currentDate.setDate(currentDate.getDate() + 7);
            document.getElementById('day').value = currentDate.toISOString().slice(0, 10)
            document.getElementById("this_week").submit();
        }
        class_list = JSON.parse('{{ class_list|tojson }}');

        function createClassElement(classInfo) {
            const classElement = document.createElement("div");
            classElement.className = "border text-center little_box";
            classElement.setAttribute("data-bs-toggle", "modal");
            classElement.setAttribute("data-bs-target", "#myOwnModal2");
            if (classInfo){
                classElement.style.height = (classInfo.continuance * 100) + "px"; // Adjust height based on continuance
                classElement.innerHTML = `<p>${classInfo.class_name}</p>`;
                classElement.setAttribute("onclick", "showLink("+ classInfo.id +")");
            }else {
                classElement.style.height = "50px";
            }

            return classElement;
        }
        for (const day in class_list) {
            if (class_list.hasOwnProperty(day)) {
                const dayContainer = document.getElementById("day" + day);
                let break_time = 0
                for (let hour = 10; hour <= 18; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        if (break_time){
                            break_time--
                            break;
                        }
                        const classesInSlot = class_list[day].filter(function (classInfo) {
                            return Math.floor(classInfo.start_time) === hour && classInfo.start_time % 1 * 60 === minute;
                        });
                        if (classesInSlot.length > 0) {
                            classesInSlot.forEach(function (classInfo) {
                                break_time = classInfo["continuance"]/0.5 - 1
                                const classElement = createClassElement(classInfo);
                                dayContainer.appendChild(classElement);
                            });
                        } else {
                            const emptySlot = createClassElement();
                            dayContainer.appendChild(emptySlot);
                        }
                    }
                }
            }
        }
        function showLink(id){
            console.log(id)
        }
    </script>
    {% block timetable_js %}{% endblock %}
{% endblock %}