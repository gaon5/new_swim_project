{% extends "guest/layout.html" %}

{% block mycss %}
    <style>
        #navigation-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #info {
            margin: 0 20px;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container mt-3">
        <div class="row" style="min-width: 720px">
            <h1>Class Timetable 2023</h1>
            <form action="{{ url_for('display_timetable') }}" method="post" id="this_week">
                <input type="hidden" id="day" name="day">
                <div id="navigation-container">
                    <button type="button" class="mx-5 px-2" onclick="previous_week()">&larr;</button>
                    
                    <label for="pool_type"></label>
                    <select name="pool_type" id="pool_type">
                        <option value="" disabled selected value>-- select a pool --</option>
                        {% for pool in pool_list%}
                            <option value="{{ pool[0] }}">{{ pool[1] }}</option>
                        {% endfor %}
                    </select>
                    <label for="class_type"></label>
                    <select name="class_type" id="class_type">
                        <option value="" disabled selected value>-- select a class type --</option>
                        <option value="0">Aqua Aerobic Classes</option>
                        <option value="1">Individual Swimming Lesson</option>
                    </select>
                    <button type="submit" class="mx-5 px-2" onclick="same_week()">Submit</button>
                    <button type="button" class="mx-5 px-2" onclick="next_week()">&rarr;</button>
                </div>
            </form>
            {% for i in range(8) %}
                <div class="col" style="padding: 0;">
                    <div class="col border text-center" style="background-color: #212529; color: white; min-height: 50px;">{{ week_list[i][0] }}<br>{{ week_list[i][1] }}</div>
                    {% for j in range(10,19,1) %}
                        {% if i == 0 %}
                            <div class="border text-center" style="min-height: 100px;">{{ j }}:00</div>
                        {% else %}
                            {% set vars = {'foo': True} %}
                            {% set show_list = [] %} <!--Create an empty show_list to store multiple activities-->
                            {% for class in class_list %}
                                {% if class[2] == week_list[i][0] and class[3] == j %}
                                    {{ show_list.append({class[0]:class[1]}) or "" }}
                                    {% if vars.update({'foo': False}) %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            {% if vars.foo %} <!--Append empty space only when there is no class-->
                                <div class="border text-center" style="min-height: 50px;"></div>
                                <div class="border text-center" style="min-height: 50px;"></div>
                            {% else %} <!--Display multiple activities (if any) in a division-->
                                <div class="border text-center" style="min-height: 50px;">
                                    {% for show in show_list %}
                                        {% for key in show %}
                                            <a href="/display_class/{{ key }}">{{ show[key] }}</a><br>
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>


    {% block timetable_body %}{% endblock %}



{% endblock %}

{% block myjs %}
    <script>
        function previous_week(){
            const currentDate = new Date("{{ today }}");
            currentDate.setDate(currentDate.getDate() - 7);
            document.getElementById('day').value = currentDate.toISOString().slice(0, 10)
            document.getElementById("this_week").submit();
        }
        function next_week(){
            const currentDate = new Date("{{ today }}");
            currentDate.setDate(currentDate.getDate() + 7);
            document.getElementById('day').value = currentDate.toISOString().slice(0, 10)
            document.getElementById("this_week").submit();
        }
        function same_week(){
            const currentDate = new Date("{{ today }}");
            currentDate.setDate(currentDate.getDate());
            document.getElementById('day').value = currentDate.toISOString().slice(0, 10)
            document.getElementById("this_week").submit();
        }
    </script>
{% endblock %}